import 'package:intl/intl.dart';

Map<String, Map<String, Map<String, String>>> prayerTimeBD = {
  'June': {
    '1': {
      'Shahri': '3:39',
      'Sunrise': '5:10',
      'Fajr': '3:45',
      'Dhuhr': '12:00',
      'Asr': '4:35',
      'Maghrib': '6:46',
      'Isha': '8:11',
    },
    '2': {
      'Shahri': '3:39',
      'Sunrise': '5:10',
      'Fajr': '3:45',
      'Dhuhr': '12:00',
      'Asr': '4:35',
      'Maghrib': '6:46',
      'Isha': '8:11',
    },
    '3': {
      'Shahri': '3:39',
      'Sunrise': '5:10',
      'Fajr': '3:45',
      'Dhuhr': '12:00',
      'Asr': '4:35',
      'Maghrib': '6:46',
      'Isha': '8:11',
    },
    '4': {
      'Shahri': '3:39',
      'Sunrise': '5:10',
      'Fajr': '3:45',
      'Dhuhr': '12:00',
      'Asr': '4:35',
      'Maghrib': '6:46',
      'Isha': '8:11',
    },
    '5': {
      'Shahri': '3:39',
      'Sunrise': '5:10',
      'Fajr': '3:45',
      'Dhuhr': '12:00',
      'Asr': '4:35',
      'Maghrib': '6:46',
      'Isha': '8:11',
    },
    '6': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '7': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '8': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '9': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '10': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '11': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:01',
      'Asr': '4:36',
      'Maghrib': '6:47',
      'Isha': '8:13',
    },
    '12': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '4:38',
      'Maghrib': '6:50',
      'Isha': '8:16',
    },
    '13': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '4:38',
      'Maghrib': '6:50',
      'Isha': '8:16',
    },
    '14': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '4:38',
      'Maghrib': '6:50',
      'Isha': '8:16',
    },
    '15': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '4:38',
      'Maghrib': '6:50',
      'Isha': '8:16',
    },
    '16': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '16:38',
      'Maghrib': '18:50',
      'Isha': '20:16',
    },
    '17': {
      'Shahri': '3:38',
      'Sunrise': '5:10',
      'Fajr': '3:44',
      'Dhuhr': '12:02',
      'Asr': '16:38',
      'Maghrib': '18:50',
      'Isha': '20:16',
    },
    '18': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '16:39',
      'Maghrib': '18:51',
      'Isha': '20:18',
    },
    '19': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '4:39',
      'Maghrib': '6:51',
      'Isha': '8:18',
    },
    '20': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '4:39',
      'Maghrib': '6:51',
      'Isha': '8:18',
    },
    '21': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '4:39',
      'Maghrib': '6:51',
      'Isha': '8:18',
    },
    '22': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '4:39',
      'Maghrib': '6:51',
      'Isha': '8:18',
    },
    '23': {
      'Shahri': '3:38',
      'Sunrise': '5:11',
      'Fajr': '3:44',
      'Dhuhr': '12:03',
      'Asr': '4:39',
      'Maghrib': '6:51',
      'Isha': '8:18',
    },
    '24': {
      'Shahri': '3:39',
      'Sunrise': '5:11',
      'Fajr': '3:45',
      'Dhuhr': '12:04',
      'Asr': '4:40',
      'Maghrib': '6:53',
      'Isha': '8:19',
    },
    '25': {
      'Shahri': '3:39',
      'Sunrise': '5:11',
      'Fajr': '3:45',
      'Dhuhr': '12:04',
      'Asr': '4:40',
      'Maghrib': '6:53',
      'Isha': '8:19',
    },
    '26': {
      'Shahri': '3:39',
      'Sunrise': '5:11',
      'Fajr': '3:45',
      'Dhuhr': '12:04',
      'Asr': '4:40',
      'Maghrib': '6:53',
      'Isha': '8:19',
    },
    '27': {
      'Shahri': '3:39',
      'Sunrise': '5:11',
      'Fajr': '3:45',
      'Dhuhr': '12:04',
      'Asr': '4:40',
      'Maghrib': '6:53',
      'Isha': '8:19',
    },
    '28': {
      'Shahri': '3:39',
      'Sunrise': '5:11',
      'Fajr': '3:45',
      'Dhuhr': '12:04',
      'Asr': '4:40',
      'Maghrib': '6:53',
      'Isha': '8:19',
    },
    '29': {
      'Shahri': '3:43',
      'Sunrise': '5:14',
      'Fajr': '3:48',
      'Dhuhr': '12:06',
      'Asr': '4:42',
      'Maghrib': '6:53',
      'Isha': '8:20',
    },
    '30': {
      'Shahri': '3:43',
      'Sunrise': '5:14',
      'Fajr': '3:48',
      'Dhuhr': '12:06',
      'Asr': '4:42',
      'Maghrib': '6:53',
      'Isha': '8:20',
    },
  },
};

String addMinutesToTime(String timeString, int minutesToAdd) {
  final currentTime = DateTime.now();

  // Parse the time string and combine with the current date
  final combinedDateTime = DateFormat('yyyy-MM-dd HH:mm').parse(
      '${currentTime.year}-${currentTime.month.toString().padLeft(2, '0')}-${currentTime.day.toString().padLeft(2, '0')} $timeString');

  // Add minutes
  final updatedDateTime = combinedDateTime.add(Duration(minutes: minutesToAdd));

  // Format the updated DateTime back to the time string format
  final updatedTimeString = DateFormat('HH:mm').format(updatedDateTime);

  print('Original time: $timeString');
  print('Updated time: $updatedTimeString');
  return updatedTimeString;
}

List<String> getPrayerTiming(String month, String date, String timings) {
  // final formattedMonth = month.toLowerCase();
  var formattedMonth = month;
  if (prayerTimeBD.containsKey(formattedMonth)) {
    final monthData = prayerTimeBD[formattedMonth];

    if (monthData!.containsKey(date)) {
      final prayerTimings = monthData[date];

      if (prayerTimings!.containsKey(timings)) {
        var x = prayerTimings[timings];
        // return prayerTimings[timings];

        final List<String> timingParts = x!.split(':');
        return timingParts;
      }
    }
  }

  return [];
}

// String calculateIshaJamaat(String timeString, int minutesToAdd) {

String calculateIshaJamaat(String timeString, int minutesToAdd) {
  final currentTime = DateTime.now();

  // Parse the time string and combine with the current date
  final combinedDateTime = DateFormat('yyyy-MM-dd HH:mm').parse(
      '${currentTime.year}-${currentTime.month.toString().padLeft(2, '0')}-${currentTime.day.toString().padLeft(2, '0')} $timeString');

  // Add minutes
  final updatedDateTime = combinedDateTime.add(Duration(minutes: minutesToAdd));

  // Check if the resulting time is beyond 8:45
  final maxTime = DateTime(
    currentTime.year,
    currentTime.month,
    currentTime.day,
    8,
    45,
  );
  final updatedDateTimeCapped =
      updatedDateTime.isAfter(maxTime) ? maxTime : updatedDateTime;

  // Calculate the difference in minutes between the original and updated time
  final differenceInMinutes =
      updatedDateTimeCapped.difference(combinedDateTime).inMinutes;

  // Calculate the nearest quarter-hour
  final roundedMinutes = (differenceInMinutes / 15).ceil() * 15;

  // Adjust the updated time by the rounded minutes
  final updatedDateTimeRounded =
      updatedDateTimeCapped.add(Duration(minutes: roundedMinutes));

  // Format the updated DateTime back to the time string format
  final updatedTimeString = DateFormat('HH:mm').format(updatedDateTimeRounded);

  print('Original time: $timeString');
  print('Updated time: $updatedTimeString');
  return updatedTimeString;
}
